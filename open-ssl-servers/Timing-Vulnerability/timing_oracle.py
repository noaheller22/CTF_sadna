import socket, binascii, time

SERVER_HOST = "nova.cs.tau.ac.il"
SERVER_PORT = 5002

def measure(cipher_hex: str) -> float:
    """Send a ciphertext, measure elapsed time"""
    ciphertext = binascii.unhexlify(cipher_hex.strip())
    s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
    s.settimeout(5)
    s.connect((SERVER_HOST, SERVER_PORT))
    start = time.perf_counter()
    s.sendall(ciphertext)
    _ = s.recv(4096)  # ignore "done"
    elapsed = time.perf_counter() - start
    s.close()
    return elapsed

if __name__ == "__main__":
    while True:
        cipher_hex = input("Type cipher (in hex) here: ").strip()
        if cipher_hex.lower() == "done":
            break
        try:
            elapsed = measure(cipher_hex)
            print(f"Response time: {elapsed:.6f} seconds")
            if elapsed >= 0.05:
                print("=> classified as VALID")
            else:
                print("=> classified as INVALID")
        except Exception as e:
            print("Error:", e)
            break
