import socket, ssl, binascii

SERVER_HOST = "132.67.247.151" 
SERVER_PORT = 4434

def query_oracle(ciphertext: bytes) -> bool:
    try:
        sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
        context = ssl._create_unverified_context()
        secure_sock = context.wrap_socket(sock, server_hostname=SERVER_HOST)
        secure_sock.connect((SERVER_HOST, SERVER_PORT))
        secure_sock.send(ciphertext)
        response = secure_sock.recv(1024).decode()
        secure_sock.close()

        if response.startswith("valid:"):
            return True
        return False
    except Exception as e:
        print(f"Oracle error: {str(e)}")
        return False

if __name__ == "__main__":
    while True:
        cipher_hex = input("Type cipher (in hex) here or type done to end: ").strip()
        if cipher_hex.lower() == "done":
            break
        try:
            ciphertext = binascii.unhexlify(cipher_hex)
        except binascii.Error:
            print("Input not valid hex â†’ TRY AGAIN")
            continue

        is_valid = query_oracle(ciphertext)
        if is_valid:
            print(f"=> classified as VALID ")
        else:
            print(f"=> classified as INVALID")
